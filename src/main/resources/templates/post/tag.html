<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <title>æ ‡ç­¾ - ç åŒ è®ºå›</title>
    <link rel="stylesheet" th:href="@{/static/layui/css/layui.css}" media="all"/>
    <link rel="stylesheet" th:href="@{/static/common/custom.css}" media="all"/>
    <link rel="stylesheet" th:href="@{/static/css/index.css}" media="all"/>
    <link rel="stylesheet" th:href="@{/static/css/Source Han Sans CN Regular.css}" media="all"/>
    <link rel="stylesheet" th:href="@{/static/fontawesome/css/fontawesome.min.css}" media="all"/>
    <script th:src="@{/static/layui/layui.js}"></script>
    <script th:src="@{/static/swiper/swiper.min.js}"></script>
    <script th:src="@{/static/js/search.js}"></script>
    <script th:src="@{/static/common/jquery.min.js}"></script>
    <script th:src="@{/static/js/forum.js}"></script>
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <header th:replace="common/header"></header>

    <div class="layui-fluid">
        <!-- å·¦ä¾§ä¸»ä½“éƒ¨åˆ† -->
        <div class="layui-col-md8 my-height">
            <div class="layui-tab layui-tab-brief" lay-filter="tab-questions">
                <ul class="layui-tab-title forum-nav">
                    <i class="layui-icon layui-icon-note"
                       style="font-size: 18px;vertical-align: bottom;margin-right: 12px;margin-left:20px;font-weight: 900;">&nbsp;<span
                            style="font-size: 22px;font-weight: 400" th:utext="'æ ‡ç­¾ï¼š' + ${tagName}"></span></i>
                    <li class="layui-this">æœ€æ–°</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show" id="newQues"></div>
                    <!-- åˆ†é¡µæ’ä»¶ -->
                    <div id="ques-pagination"></div>
                </div>
            </div>
        </div>

        <!-- å³ä¾§éƒ¨åˆ† -->
<!--        <div class="layui-col-md4" style="margin-top: 20px">-->
<!--            <div class="right-header">ğŸ”–&nbsp;çƒ­é—¨æ ‡ç­¾</div>-->
<!--            <div style="margin-left: 40px;margin-top: 10px" id="hot-tags">-->
<!--                <div class="hot_tag">-->
<!--                    <div><a class="tagname" href="javascript:;"><span></span></a></div>-->
<!--                </div>-->
<!--            </div>-->
<!--            &lt;!&ndash;çƒ­é—¨æ¨è&ndash;&gt;-->
<!--            <div class="right-header"  style="margin-top:20px">ğŸŒ&nbsp;çƒ­é—¨æ¨è</div>-->
<!--            <div style="margin-left: 40px;margin-top: 10px">-->
<!--                <ul class="recommend-list">-->
<!--                </ul>-->
<!--            </div>-->
<!--        </div>-->
    </div>

<!--    <footer th:replace="common/footer"></footer>-->
</div>
<script th:inline="javascript">
    let totalCount = 0;  //æ•°æ®æ€»æ¡æ•°
    let loginUserInfo = [[${session.loginUserInfo}]];
    init(loginUserInfo);

    layui.use(['element', 'carousel', 'laypage', 'layer', 'form'], function () {
        let element = layui.element;
        let carousel = layui.carousel;
        let laypage = layui.laypage;
        let form = layui.form;

        let tagName = [[${tagName}]];

        //é¢åŒ…å±‘ä½¿ç”¨
        let currPoisition = "<span lay-separator=\"\">&gt;</span><a><cite>æ ‡ç­¾</cite></a><span lay-separator=\"\">&gt;</span><a><cite>"+ tagName +"</cite></a>";
        $(".layui-breadcrumb a").last().after(currPoisition);
        element.init();

        let currId = "#newQues";
        let currURL = "/getQuestionByTag";

        //åˆ†é¡µ
        laypage.render({
            elem: 'ques-pagination'
            , count: totalCount
            , page: true
            , layout: ['count', 'prev', 'page', 'next', 'skip']
            , jump: function (obj) {
                pageQuery(obj.curr, obj.limit,tagName, currURL, currId);
            }
        });
    });

    //é¡µé¢åŠ è½½å®Œæˆå°±å¼€å§‹
    $(document).ready(function () {
        let tagName = [[${tagName}]];

        $(".searchQues").hover(function () {
            $(".layui-nav .layui-this:after, .layui-nav-bar, .layui-nav-tree .layui-nav-itemed:after").css("background-color", "");
        });

        //è·å–æ•°æ®åº“ä¸­åŒ…å«è¯¥æ ‡ç­¾çš„é—®é¢˜çš„æ€»æ•°
        $.ajax({
            type: "get",
            url: "/getQuestionByTagTotalCount",
            data:{
                "tagName": tagName
            },
            success: function (res) {
                if (res.status === 200) {
                    totalCount = res.data;
                }
            }
        });

        //æŸ¥è¯¢æ¨èæ–‡ç« ä¿¡æ¯
        $.get("/getRecommendQuestion", function (res) {
            let recommendHtml = "";
            if (res.status === 200) {
                $.each(res.data, function (i, item) {
                    recommendHtml += "<li class=\"list-group-item\"><a href=\"/question/" + item.id + "\">" + item.title + "</a><span>æµè§ˆé‡ï¼š" + item.viewCount + "</span></li>";
                })
            }
            $(".recommend-list").html(recommendHtml);
        });

        //æŸ¥è¯¢æ ‡ç­¾æ¨è
        $.get("/getMostReferTag", function (res) {
            let html = "";
            if (res.status === 200) {
                $.each(res.data, function (i, item) {
                    html += "    <div class=\"hot_tag\">\n" +
                        "            <div><a class=\"tagname\" href=\"/tag?tagname=\""+ item +"><span><i class=\"fa fa-paperclip\" aria-hidden=\"true\"></i>&nbsp;" + item + "</span></a></div>\n" +
                        "        </div>";
                });

                $("#hot-tags").html(html);
            }
        })
    });

    //æŸ¥è¯¢åˆ†é¡µä¿¡æ¯
    function pageQuery(currPage, pageSize,tagName, url, id) {
        //é¡µé¢åŠ è½½å®Œæˆåå»æŸ¥è¯¢æ•°æ®åº“ä¸­é—®é¢˜ä¿¡æ¯ï¼Œæ¸²æŸ“åˆ°é¡µé¢ä¸Š
        $.ajax({
            type: "get",
            url: url,
            async: false,
            data: {
                "currPage": currPage,
                "pageSize": pageSize,
                "tagName": tagName
            },
            success: function (res) {
                //å–å‡ºæ‰€æœ‰çš„é—®é¢˜ä¿¡æ¯
                let questionArray = res.data;
                let html = "";
                for (let i = 0; i < questionArray.length; i++) {
                    let quesHtml = "          <li class=\"boxContent\">\n" +
                        "                        <div>\n" +
                        "                            <div class=\"user_bar\">\n" +
                        "                                <div class='hook' style=\"display: inline-block;float: left;\">\n" +
                        "                                    <a href=\"/user/" + questionArray[i].uid + "\" style=\"text-decoration: none;height: 45px;width: 45px;\">\n" +
                        "                                        <img src=" + questionArray[i].avatar + "\n" +
                        "                                             alt=\"\" style=\"height: 48px;width: 48px;border-radius: 10px;\">\n" +
                        "                                    </a>\n" +
                        "                                </div>\n" +
                        "                                <div class='userToolTip'><div class=\"arrow\"></div>\n" +
                        "                                    <span>è¿™æ˜¯ä¸€ä¸ªæç¤ºæ¡†</span>\n" +
                        "                                </div>\n" +
                        "                                <div class=\"floatR\" style=\"\">\n" +
                        "                                    <a href=\"/question/" + questionArray[i].id + "\">\n" +
                        "                                        <div class=\"title\" style=\"display: inline-block;\">" + questionArray[i].title + "</div>\n" +
                        "                                    </a>\n" +
                        "                                    <div style=\"font-size: 13px;margin-top: 10px;\">\n" +
                        "                                        <span class='question-tags'>"+ questionArray[i].tag +"</span>&nbsp;\n" +
                        "                                        <span><span>æé—®è€…ï¼š<a href='/user/"+ questionArray[i].uid  +"'>" + questionArray[i].publisher + "</a></span></span>\n" +
                        "                                        <span>&nbsp;&nbsp;&nbsp;æµè§ˆé‡ï¼š<span>" + questionArray[i].viewCount + "</span></span>\n" +
                        "                                        <span>&nbsp;&nbsp;&nbsp;è¯„è®ºæ•°ï¼š<span>" + questionArray[i].commentCount + "</span></span>\n" +
                        "                                        <span>&nbsp;&nbsp;&nbsp;å‘å¸ƒäºï¼š<span>" + questionArray[i].gmtCreate + "</span></span>\n" +
                        "                                    </div>\n" +
                        "                                </div>\n" +
                        "                            </div>\n" +
                        "                        </div>\n" +
                        "                    </li>";
                    html += quesHtml;
                }
                $(id).html(html);

            },
            error: function () {
                layer.alert("ç³»ç»Ÿé”™è¯¯ï¼Œè¯·ç¨åå†è¯•", {icon: 5, time: 2000});
            }
        });
    }
</script>
</body>
</html>