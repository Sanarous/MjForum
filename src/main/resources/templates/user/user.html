<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <link rel="stylesheet" th:href="@{/static/layui/css/layui.css}" media="all"/>
    <link rel="stylesheet" th:href="@{/static/common/userinfo.css}" media="all"/>
    <link rel="stylesheet" th:href="@{/static/common/custom.css}" media="all"/>
    <link rel="stylesheet" th:href="@{/static/css/user.css}" media="all"/>
    <!--<link href="//netdna.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">-->
    <link rel="stylesheet" th:href="@{/static/fontawesome/css/fontawesome.min.css}" media="all"/>
    <script th:src="@{/static/layui/layui.js}"></script>
    <script th:src="@{/static/js/search.js}"></script>
    <script th:src="@{/static/common/jquery.min.js}"></script>
    <script th:src="@{/static/js/forum.js}"></script>
    <style type="text/css">
        /* ÊêúÁ¥¢Ê†∑Âºè */
        #search {
            margin-left: 60px;
        }

        .d1 input {
            width: 130%;
            height: 33px;
            padding-left: 10px;
            padding-right: 0 !important;
            padding-bottom: 0 !important;
            padding-top: 0 !important;
            border: 2px solid #fff;
            color: #9E9C9C;
        }

        .d1 button {
            position: absolute;
            top: 11px;
            right: -71px;
            width: 41px;
            height: 38px;
            border: none;
            background: #5FB878;
            cursor: pointer;
        }

        .d1 button:before {
            content: "\f002";
            font-family: FontAwesome;
            font-size: 16px;
            color: #F9F0DA;
        }
    </style>
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <header th:replace="common/header"></header>

    <div id="user-index-body" style="margin-left: 33%;margin-top: 2%">
        <!-- Áî®Êà∑‰ø°ÊÅØ -->
        <div class="user-index-header">

        </div>
        <!-- ÂØºËà™Ê†è -->
        <div class="layui-tab layui-tab-brief" lay-filter="userIndex" style="margin: 10px 500px 0 0;">
            <ul class="layui-tab-title">
                <li class="layui-this" id="myQuestionsTab">üôã‚Äç‚ôÇÊàëÁöÑÈóÆÈ¢ò</li>
                <li>üí¨ ÊàëÁöÑËØÑËÆ∫</li>
                <li>üè∑Ô∏è ÊàëÁöÑÊî∂Ëóè</li>
                <li>üî• ÁÉ≠Èó®ÈóÆÈ¢ò</li>
            </ul>
            <div class="layui-tab-content" style="height: 100px;">
                <!-- ÊàëÁöÑÈóÆÈ¢ò -->
                <div class="layui-tab-item layui-show" id="myQuestions"></div>
                <!-- ÊàëÁöÑÂõûÂ§ç -->
                <div class="layui-tab-item" id="myComments"></div>
                <!-- ÊàëÁöÑÊî∂Ëóè -->
                <div class="layui-tab-item" id="myCollection"></div>
                <!-- ÊúÄÁÉ≠ÈóÆÈ¢ò -->
                <div class="layui-tab-item" id="myHotQuestions"></div>
            </div>
        </div>
    </div>
    <footer th:replace="common/footer"></footer>
</div>
<script th:inline="javascript">
    layui.use(['element', 'form', 'jquery'], function () {
        let element = layui.element;
        $ = layui.jquery;

        //Ëé∑ÂèñuserÁöÑ‰∏™‰∫∫‰ø°ÊÅØ
        let username = [[${username}]];

        //ÁõëÂê¨ÈÄâÈ°πÂç°ÂàáÊç¢‰∫ã‰ª∂
        element.on('tab(userIndex)', function (data) {
            if (data.index === 0) {
                //ÊàëÁöÑÈóÆÈ¢ò
                //Ëé∑ÂèñÊàëÁöÑÈóÆÈ¢òËØ¶ÊÉÖ
                let html = "<div id=\"questions\"><ul class=\"question-list\">";
                $.ajax({
                    type: "get",
                    url: "/getMyQuestions",
                    async: false,
                    data: {username: username},
                    success: function (res) {
                        if (res.status === 200) {
                            //Ê∑ªÂä†html
                            if (res.data == null) {
                                html += "<div style='font-size: 17px;font-weight: 300;'>ÊÇ®ÊöÇÊú™ÂèëÂ∏ÉÈóÆÈ¢ò</div>";
                            } else {
                                var questionArray = res.data;
                                $.each(questionArray, function (i, item) {
                                    html += "                       <li>\n" +
                                        "                                <div class=\"content\">\n" +
                                        "                                    <a class=\"title\" target=\"_blank\" href=\"/question/" + item.id + "\">" + item.title + "</a>\n" +
                                        "                                    <p class=\"abstract\">" + item.description + "</p>\n" +
                                        "                                    <div class=\"meta\">\n" +
                                        "                                        <a target=\"_blank\" href=\"#\">\n" +
                                        "                                            <i class=\"fa fa-eye\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span>" + item.viewCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                        </a>\n" +
                                        "                                        <span><i class=\"fa fa-comments\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span>" + item.commentCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                        </span>\n" +
                                        "                                        <a target=\"_blank\" href=\"#\">\n" +
                                        "                                            <i class=\"fa fa-heart\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span>" + item.likeCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                        </a>\n" +
                                        "\n" +
                                        "                                        <span class=\"time\" data-shared-at=\"2019-07-15T14:24:48+08:00\">\n" +
                                        "                                            <i class=\"fa fa-clock-o\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span> " + item.gmtCreate + "</span>\n" +
                                        "                                        </span>\n" +
                                        "                                    </div>\n" +
                                        "                                </div>\n" +
                                        "                            </li>";
                                });
                            }
                        }
                    }
                });
                html += "</ul></div>";
                console.log(html);
                $("#myQuestions").html(html);
            } else if (data.index === 1) {
                //ÊàëÁöÑËØÑËÆ∫
                let html = "<div id=\"comments\"><ul class=\"comment-list\">";
                $.ajax({
                    type: "get",
                    url: "/getMyCommentInfo",
                    async: false,
                    data: {username: username},
                    success: function (res) {
                        if (res.status === 200) {
                            if (res.data == null) {
                                html += "<div style='font-size: 17px;font-weight: 300;'>ÊöÇÊó†ËØÑËÆ∫Ê∂àÊÅØ</div>";
                            } else {
                                var commentArray = res.data;
                                $.each(commentArray, function (i, item) {
                                    html += "                     <li>\n" +
                                        "                                <div class=\"content\">\n" +
                                        "                                    <div class=\"author\">\n" +
                                        "                                        <a class=\"avatar\" href=\"#\">\n" +
                                        "                                            <img style=\"width: 30px;height: 30px;border-radius: 50%\"\n" +
                                        "                                                 src=\"" + item.avatar + "\"\n" +
                                        "                                                 alt=\"180\">\n" +
                                        "                                        </a>\n" +
                                        "                                        <div class=\"info\">\n" +
                                        "                                            <a class=\"nickname\" href=\"#\">" + item.username + "</a>\n" +
                                        "                                            <span data-type=\"share_note\" data-datetime=\"2019-06-11T16:56:18+08:00\"> ÂèëË°®‰∫ÜËØÑËÆ∫ ¬∑ " + item.time + "</span>\n" +
                                        "                                        </div>\n" +
                                        "                                    </div>\n" +
                                        "                                    <p class=\"comment\" style=\"margin-bottom: 10px;\">" + item.comment + "</p>\n" +
                                        "                                    <blockquote>\n" +
                                        "                                        <a class=\"title\" href=\"/question/" + item.questionId + "\">" + item.title + "</a>\n" +
                                        "                                        <p class=\"abstract\">" + item.contents + "</p>\n" +
                                        "                                        <div class=\"meta\" style=\"font-size: 12px\">\n" +
                                        "                                            <a target=\"_blank\" href=\"#\">\n" +
                                        "                                                <i class=\"fa fa-eye\" aria-hidden=\"true\"></i>\n" +
                                        "                                                <span>" + item.viewCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                            </a>\n" +
                                        "                                            <span><i class=\"fa fa-comments\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span>" + item.commentCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                        </span>\n" +
                                        "                                            <a target=\"_blank\" href=\"#\">\n" +
                                        "                                                <i class=\"fa fa-heart\" aria-hidden=\"true\"></i>\n" +
                                        "                                                <span>" + item.likeCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                            </a>\n" +
                                        "                                        </div>\n" +
                                        "                                    </blockquote>\n" +
                                        "                                </div>\n" +
                                        "                            </li>";
                                })
                            }
                        }
                    }
                });

                html += "</ul></div>";

                $("#myComments").html(html);
            } else if (data.index === 2) {
                //ÊàëÁöÑÊî∂Ëóè
                let html = "<div id=\"collection\"><ul class=\"collection-list\">";
                $.ajax({
                    type: "get",
                    url: "/getMyCollection",
                    async: false,
                    data: {username: username},
                    success: function (res) {
                        if (res.status === 200) {
                            if (res.data == null) {
                                html += "<div style='font-size: 17px;font-weight: 300;'>ÊÇ®ÊöÇÊó†Êî∂ËóèÁöÑÈóÆÈ¢ò</div>";
                            } else {
                                let collectionArray = res.data;
                                $.each(collectionArray, function (i, item) {
                                    html += "<li>\n" +
                                        "          <div class=\"content\">\n" +
                                        "               <a class=\"title\" target=\"_blank\" href=\"/question/" + item.id + "\">" + item.title + "</a>\n" +
                                        "                    <p class=\"abstract\">" + item.description + "</p>\n" +
                                        "                     <div class=\"meta\">\n" +
                                        "                          <a target=\"_blank\" href=\"#\">\n" +
                                        "                               <i class=\"fa fa-eye\" aria-hidden=\"true\"></i>\n" +
                                        "                                    <span>" + item.viewCount + "&nbsp;&nbsp;</span>\n" +
                                        "                          </a>\n" +
                                        "                          <span><i class=\"fa fa-comments\" aria-hidden=\"true\"></i>\n" +
                                        "                          <span>" + item.commentCount + "&nbsp;&nbsp;</span>\n" +
                                        "                          </span>\n" +
                                        "                          <a target=\"_blank\" href=\"#\">\n" +
                                        "                               <i class=\"fa fa-heart\" aria-hidden=\"true\"></i>\n" +
                                        "                                   <span>" + item.likeCount + "&nbsp;&nbsp;</span>\n" +
                                        "                               </a>\n" +
                                        "                          <span class=\"time\" data-shared-at=\"2019-07-15T14:24:48+08:00\">\n" +
                                        "                                 <i class=\"fa fa-clock-o\" aria-hidden=\"true\"></i>\n" +
                                        "                                  <span> " + item.gmtCreate + "</span>\n" +
                                        "                            </span>\n" +
                                        "                   </div>\n" +
                                        "          </div>\n" +
                                        "     </li>";
                                });
                            }
                        }
                    }
                });
                html += "</ul><div>";
                $("#myCollection").html(html);

            } else if (data.index === 3) {
                let html = "<div id=\"hotQuestion\"><ul class=\"hotQuestion-list\">";
                $.ajax({
                    type: "get",
                    url: "/getMyHotQuestions",
                    async: false,
                    data: {username: username},
                    success: function (res) {
                        if (res.status === 200) {
                            if (res.data == null) {
                                html += "<div style='font-size: 17px;font-weight: 300;'>ÊöÇÊó†ÈóÆÈ¢ò‰ø°ÊÅØ</div>";
                            } else {
                                var questionArray = res.data;
                                $.each(questionArray, function (i, item) {
                                    html += "                       <li>\n" +
                                        "                                <div class=\"content\">\n" +
                                        "                                    <a class=\"title\" target=\"_blank\" href=\"/question/" + item.id + "\">" + item.title + "</a>\n" +
                                        "                                    <p class=\"abstract\">" + item.description + "</p>\n" +
                                        "                                    <div class=\"meta\">\n" +
                                        "                                        <a target=\"_blank\" href=\"#\">\n" +
                                        "                                            <i class=\"fa fa-eye\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span>" + item.viewCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                        </a>\n" +
                                        "                                        <span><i class=\"fa fa-comments\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span>" + item.commentCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                        </span>\n" +
                                        "                                        <a target=\"_blank\" href=\"#\">\n" +
                                        "                                            <i class=\"fa fa-heart\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span>" + item.likeCount + "&nbsp;&nbsp;</span>\n" +
                                        "                                        </a>\n" +
                                        "\n" +
                                        "                                        <span class=\"time\" data-shared-at=\"2019-07-15T14:24:48+08:00\">\n" +
                                        "                                            <i class=\"fa fa-clock-o\" aria-hidden=\"true\"></i>\n" +
                                        "                                            <span> " + item.gmtCreate + "</span>\n" +
                                        "                                        </span>\n" +
                                        "                                    </div>\n" +
                                        "                                </div>\n" +
                                        "                            </li>";
                                });
                            }
                        }
                    }
                });
                html += "</ul></div>";
                $("#myHotQuestions").html(html);
            }
        });

        //ÈÄâ‰∏≠
        $('.layui-header li').click(function () {
            $(this).addClass('layui-this').siblings().removeClass('layui-this');
        });

    });

    //È°µÈù¢Âä†ËΩΩÂÆåÊàêÂ∞±ÂºÄÂßã
    $(document).ready(function () {
        let username = [[${session.username}]];
        let token = [[${session.uid}]];
        //ËµãÂÄºÁªôËæìÂÖ•Ê°Ü
        $("#username").attr("value", username);

        init(username, token);

        if (($.trim(username).length > 0)) {

            //Ëé∑ÂèñÊàëÁöÑËØ¶ÊÉÖÈ°µÈù¢
            let queryUsername = [[${username}]];
            $.ajax({
                type: "get",
                url: "/getUserIndexInfo",
                async: false,
                data: {username: queryUsername},
                success: function (res) {
                    let html = "";
                    if (res.status === 200) {
                        let userInfo = res.data;
                        html += "            <div>\n" +
                            "                <a class=\"index-useravatar\" href=\"#\" target=\"_blank\">\n" +
                            "                    <img style=\"border-radius: 10px\" width=\"80\" height=\"80\"\n" +
                            "                         src=\"" + userInfo.avatar + "\"\n" +
                            "                         id=\"no-view\">\n" +
                            "                </a>\n" +
                            "                <a class=\"index-username\" href=\"#\" target=\"_blank\">" + queryUsername + "</a>" +
                            "                     <span class='focus-links' style='margin-left: 20px;vertical-align: 6px;display: none;'>ÂÖ≥Ê≥®</span>\n" +
                            "                <div class=\"user-info\" style=\"margin-left: 103px\">\n" +
                            "                    <ul style=\"margin-top: 10px\">\n" +
                            "                        <li>\n" +
                            "                            <div class=\"meta-block\" style='cursor: pointer;'><a onclick='getFollow()'><p>" + userInfo.follow + "</p><span>ÂÖ≥Ê≥® ></span></a></div>\n" +
                            "                        </li>\n" +
                            "                        <li>\n" +
                            "                            <div class=\"meta-block\" style='cursor: pointer;'><a onclick='getFans()'><p>" + userInfo.fans + "</p><span>Á≤â‰∏ù ></span></a></div>\n" +
                            "                        </li>\n" +
                            "                        <li>\n" +
                            "                            <div class=\"meta-block\"><a href=\"#\"><p>" + userInfo.questionNum + "</p><span>ÈóÆÈ¢ò ></span></a></div>\n" +
                            "                        </li>\n" +
                            "                        <li>\n" +
                            "                            <div class=\"meta-block\" style=\"border-right: none\"><a href=\"#\"><p>" + userInfo.likeCount + "</p>\n" +
                            "                                <span>Êî∂Ëé∑ÁÇπËµû</span></a></div>\n" +
                            "                        </li>\n" +
                            "                    </ul>\n" +
                            "                </div>\n" +
                            "            </div>";

                        $(".user-index-header").html(html);

                        //Âà§Êñ≠ÊòØÂê¶ÊúâÂÖ≥Ê≥®ÊåâÈíÆ
                        if (username !== queryUsername) {
                            //Â≠òÂú®ÂÖ≥Ê≥®ÊåâÈíÆ
                            $(".focus-links").show();

                            //Êü•ËØ¢ÊòØÂê¶ÂÖ≥Á≥ª‰ø°ÊÅØ
                            $.ajax({
                                type: "get",
                                url: "/getFollowStatus",
                                data: {
                                    userName: queryUsername,
                                    followName: username
                                },
                                async: false,
                                success: function (res) {
                                    if (res.status === 200) {
                                        if (res.data === 1) {
                                            //Â∑≤ÂÖ≥Ê≥®
                                            $(".focus-links").css("background-color", "#a9b5ac");
                                            $(".focus-links").html("Â∑≤ÂÖ≥Ê≥®");
                                        } else {
                                            //Êú™ÂÖ≥Ê≥®
                                            $(".focus-links").css("background-color", "#42c02e");
                                            $(".focus-links").html("ÂÖ≥Ê≥®");
                                        }
                                    }
                                }
                            });
                        } else {
                            $(".focus-links").hide();
                        }

                        //ÂÖ≥Ê≥®ÊåâÈíÆ
                        $(".focus-links").click(function () {
                            $.ajax({
                                type: "get",
                                url: "/follow",
                                async: false,
                                data: {
                                    userName: queryUsername,   //Ë¢´ÂÖ≥Ê≥®ÁöÑÁî®Êà∑Âêç
                                    followName: username   //ÁÇπÂáªÂÖ≥Ê≥®ËÄÖÁöÑÁî®Êà∑Âêç
                                },
                                success: function (res) {
                                    if (res.status === 200) {
                                        if (res.data === 0) {
                                            //ÂèñÊ∂àÂÖ≥Ê≥®
                                            $(".focus-links").css("background-color", "#42c02e");
                                            $(".focus-links").html("ÂÖ≥Ê≥®");
                                        } else {
                                            //ÂÖ≥Ê≥®Âêé
                                            $(".focus-links").css("background-color", "#a9b5ac");
                                            $(".focus-links").html("Â∑≤ÂÖ≥Ê≥®");
                                        }
                                    }
                                }
                            })
                        })

                    }
                }
            });

            //Ëé∑ÂèñÊàëÁöÑÈóÆÈ¢òËØ¶ÊÉÖ
            let html = "<div id=\"questions\"><ul class=\"question-list\">";
            $.ajax({
                type: "get",
                url: "/getMyQuestions",
                async: false,
                data: {username: queryUsername},
                success: function (res) {
                    if (res.status === 200) {
                        //Ê∑ªÂä†html
                        if (res.data == null) {
                            html += "<div style='font-size: 17px;font-weight: 300;'>ÊÇ®ÊöÇÊú™ÂèëÂ∏ÉÊ∂àÊÅØ</div>";
                        } else {
                            let questionArray = res.data;
                            $.each(questionArray, function (i, item) {
                                html += "                       <li>\n" +
                                    "                                <div class=\"content\">\n" +
                                    "                                    <a class=\"title\" target=\"_blank\" href=\"/question/" + item.id + "\">" + item.title + "</a>\n" +
                                    "                                    <p class=\"abstract\">" + item.description + "</p>\n" +
                                    "                                    <div class=\"meta\">\n" +
                                    "                                        <a target=\"_blank\" href=\"#\">\n" +
                                    "                                            <i class=\"fa fa-eye\" aria-hidden=\"true\"></i>\n" +
                                    "                                            <span>" + item.viewCount + "&nbsp;&nbsp;</span>\n" +
                                    "                                        </a>\n" +
                                    "                                        <span><i class=\"fa fa-comments\" aria-hidden=\"true\"></i>\n" +
                                    "                                            <span>" + item.commentCount + "&nbsp;&nbsp;</span>\n" +
                                    "                                        </span>\n" +
                                    "                                        <a target=\"_blank\" href=\"#\">\n" +
                                    "                                            <i class=\"fa fa-heart\" aria-hidden=\"true\"></i>\n" +
                                    "                                            <span>" + item.likeCount + "&nbsp;&nbsp;</span>\n" +
                                    "                                        </a>\n" +
                                    "\n" +
                                    "                                        <span class=\"time\" data-shared-at=\"2019-07-15T14:24:48+08:00\">\n" +
                                    "                                            <i class=\"fa fa-clock-o\" aria-hidden=\"true\"></i>\n" +
                                    "                                            <span> " + item.gmtCreate + "</span>\n" +
                                    "                                        </span>\n" +
                                    "                                    </div>\n" +
                                    "                                </div>\n" +
                                    "                            </li>";
                            });
                        }
                    }
                }
            });
            html += "</ul></div>";
            $("#myQuestions").html(html);
        }

    });

    //Êü•ËØ¢Áî®Êà∑Â§¥ÂÉè
    function getAvatar(username) {
        $.ajax({
            type: "get",
            url: "/getavatar",
            data: {username: username},
            success: function (res) {
                $("#useravatar").attr("src", res.data);  //‰ªéÊï∞ÊçÆÂ∫ì‰∏≠ËØªÂèñ
                $(".user-small-avatar").attr("src", res.data);
            },
            error: function () {
                layer.alert("Á≥ªÁªüÈîôËØØÔºåËØ∑Á®çÂêéÂÜçËØï", {icon: 5, time: 2000});
            }
        });
    }

    function getFollow() {
        let username = [[${session.username}]];
        let queryUsername = [[${username}]];
        if (username === queryUsername) {
            window.location.href = "/myfollow?choose=follow";
        }
    }

    function getFans() {
        let username = [[${session.username}]];
        let queryUsername = [[${username}]];
        if (username === queryUsername) {
            window.location.href = "/myfollow?choose=fans";
        }
    }

</script>
</body>
</html>